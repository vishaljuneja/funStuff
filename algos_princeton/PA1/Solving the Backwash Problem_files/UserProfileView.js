define(["backbone","jquery","underscore","pages/forum/app","pages/forum/views/UserProfileView.html","pages/forum/views/UserProfileThreadLink.html","pages/forum/views/UserProfileEntryLink.html","pages/forum/views/UserProfileBasics.html","js/lib/badgeville"],function(e,i,a,r,n,t,s,d,l){var o=e.View.extend({defaults:{},events:{},initialize:function(){var e=this;this.user=this.model,this.user.bind("change",this.renderBasics,this),this.user.read(),this.setupBadgevilleMissions=!1,this.user.getFullProfile(),r.api.get(this.model.activitiesUrl()).done(function(i){e.renderActivities(i)}),this.render()},render:function(){var e=this;e.$(".coursera-profile-basics").length||e.$el.html(n())},renderBasics:function(){var e=this;e.$(".coursera-profile-basics").html(d({config:r.config,user:this.user})),l.isEnabled()&&(e.renderBadgevilleTimeout=window.setTimeout(function(){e.renderBadgevilleMissions()},200)),e.user.get("search_link")&&e.$(".course-forum-profile-search a").attr("href",this.user.get("search_link")).show()},renderBadgevilleMissions:function(){var e=this;l.isEnabled()&&(e.$(".coursera-profile-badgeville-missions").show(),l.setupMissionsDisplay(e.user.get("id"),e.$(".coursera-profile-badgeville-missions-list"),l.getUserBucket(r.user.get("id")).badge_ladder,r.user.get("id")==e.user.get("id")?"you":"they"),window.clearTimeout(e.renderBadgevilleTimeout))},renderActivities:function(e){var i=this;if(e&&(e.threads.length||e.posts.length||e.comments.length)){var a=i.$(".coursera-profile-forum-activities");e.totals.threads>0&&a.append(t({threads:e.threads,total:e.totals.threads})),e.totals.posts>0&&a.append(s({entries:e.posts,header:"post",total:e.totals.posts})),e.totals.comments>0&&a.append(s({entries:e.comments,header:"comment",total:e.totals.comments})),(e.totals.threads>e.threads.length||e.totals.posts>e.posts.length||e.totals.comments>e.comments.length)&&i.$(".course-forum-profile-search").show(),a.show()}}});return o});