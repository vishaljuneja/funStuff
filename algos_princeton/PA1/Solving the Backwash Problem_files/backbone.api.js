define(["backbone","underscore","js/lib/api"],function(t,i,o){var e={sync:function(e,a,s){var n=this,r=this.urlId||this.idAttribute||"id",l=s.url?s.url:i.isFunction(this.url)?this.url():this.url;if(!this.api){var h=l||(i.isFunction(this.urlRoot)?this.urlRoot():this.urlRoot);this.api=o(h)}return"create"==e?(s.data=i.extend(this.toJSON(),s.data||{}),this.api.post(l,s)):"update"==e?this.partialUpdate?(s.data=i.extend(this.changedAttributes()||{},s.data||{}),s.force&&(i.isArray(s.force)?i.each(s.force,function(t){s.data[t]=n.get(t)}):s.data[s.force]=this.get(s.force)),this.api.patch(l+"/"+this.get(r),s)):(s.data=i.extend(this.toJSON(),s.data||{}),this.api.put(l+"/"+this.get(r),s)):"delete"==e?this.api["delete"](l+"/"+this.get(r),s):"read"==e?this instanceof t.Collection||void 0===this.get(r)?this.api.get(l,s):this.api.get(l+"/"+this.get(r),s):void 0},create:function(t,i){var o=this;return this.save(null,t).done(function(t){i&&i.call(o,null,t)}).fail(function(t,e){i&&i.call(o,e)})},update:function(t,i,o){var e=this,a=i||{};return t&&!this.isNew()&&(a.silent=void 0!==a.silent?a.silent:!0),this.save(t,a).done(function(t){o&&o.call(e,null,t)}).fail(function(t,i){o&&o.call(e,i)})},read:function(t,i){var o=this;return this.fetch(t).done(function(t){i&&i.call(o,null,t)}).fail(function(t,e){i&&i.call(o,e)})},"delete":function(t,i){var o=this;return this.destroy(t).done(function(t){i&&i.call(o,null,t)}).fail(function(t,e){i&&i.call(o,e)})}};return e});