(function(){var e=function(e,t,a,r,s,i,o,n,l,u,c){return t.defaults=e.extend(t.defaults,{"toolbar.modes":!0,"toolbar.mode.html":!0,"toolbar.mode.markdown":!1,"toolbar.mode.rich":!0,"composer.default":"rich","composer.group":"wysihtml5"}),t.plugin("modes",function(d,p,h,g){if(g["toolbar.modes"]){var f=g["prefix.css"]+"-toolbar-source",m=g["prefix.css"]+"-toolbar-wysi",b=g["prefix.css"]+"-toolbar-markdown",v=g["prefix.data"].replace(/-/g,".")+"default.mode."+g["composer.group"],y=e(a({prefix:g["prefix.css"],mode:{html:g["toolbar.mode.html"],markdown:g["toolbar.mode.markdown"],rich:g["toolbar.mode.rich"]}}));t.insertIntoRightToolbar(p,y,100);var w=m,x=null,k=function(t,a){t.find('input[name="default-mode"]').on("change",function(){e(this).is(":checked")?n.set(v,a,{expires:36500}):n.clear(v)}),g["toolbar.modes"]&&(g["toolbar.mode.html"]||g["toolbar.mode.markdown"]||g["toolbar.mode.rich"])?n.get(v)==a&&t.find('input[name="default-mode"]').attr("checked","checked"):t.find("label."+g["prefix.css"]+"-default-mode").hide()},_=function(a){d.fire("change_view","composer",a),w=m;var r=e(i({prefix:g["prefix.css"]}));k(r,"rich"),t.updateFooter(h,r)},j=function(a){w!=b&&d.fire("change_view","textarea",a),w=f,d.setValue(l(d.getValue()));var s=e(r({prefix:g["prefix.css"]}));s.find("a").on("click",function(e){e.preventDefault(),o(s.find(".modal")).open()}),k(s,"html"),t.updateFooter(h,s),e(d.textareaElement).show()},S=function(a){var r=!1;w!=f&&d.fire("change_view","textarea"),e(d.textareaElement).hide(),w=b,x||(r=!0,x=e("<textarea></textarea>").addClass(g["prefix.css"]+"-markdown-editor"),e(d.textareaElement).after(x),t.setupSecondaryTextarea(d,x)),x.val(c(d.getValue(),{inlineStyle:!0})),x.on("keyup",function(){d.setValue(u(e(this).val()))}),r&&t.setupSecondaryTextarea(d,x);var i=e(s({prefix:g["prefix.css"]}));k(i,"markdown"),t.updateFooter(h,i),a&&setTimeout(function(){x.show().focus()},0)};p.find("[data-wysihtml5-custom-command=change-editor]").on("click",function(){var a=e(this);a.hasClass("wysihtml5-command-active")||(p.find("[data-wysihtml5-custom-command=change-editor]").show().removeClass("wysihtml5-command-active"),a.addClass("wysihtml5-command-active"),t.updateFooter(h,""),x&&x.hide(),a.hasClass(m)?_(!0):a.hasClass(f)?j(!0):a.hasClass(b)&&S(!0))}),d.on("load",function(){var a=n.get(v);if("markdown"==g["composer.default"]&&!a||"markdown"==a)p.find("[data-wysihtml5-custom-command=change-editor]").show().removeClass("wysihtml5-command-active"),p.find("."+b).addClass("wysihtml5-command-active"),S(!1);else if("html"==g["composer.default"]&&!a||"html"==a)p.find("[data-wysihtml5-custom-command=change-editor]").show().removeClass("wysihtml5-command-active"),p.find("."+f).addClass("wysihtml5-command-active"),j(!1);else{var r=e(i({prefix:g["prefix.css"]}));k(r,"rich"),t.updateFooter(h,r)}})}}),t};"function"==typeof define&&define.amd?define(["jquery","bundles/wysihtml5/editor","bundles/wysihtml5/toolbar-modes.html","bundles/wysihtml5/footer-source.html","bundles/wysihtml5/footer-markdown.html","bundles/wysihtml5/footer-rich.html","js/lib/modals","js/lib/cookie","js/lib/beautify-html","js/lib/marked","js/lib/html2markdown"],function(t,a,r,s,i,o,n,l,u,c,d){return e(t,a,r,s,i,o,n,l,u,c,d)}):e(window.$,window.wysiEditor,window.jade.templates["bundles.wysihtml5.toolbar-modes"],window.jade.templates["bundles.wysihtml5.footer-source"],window.jade.templates["bundles.wysihtml5.footer-markdown"],window.jade.templates["bundles.wysihtml5.footer-rich"],window.Modal,window.Cookie,window.beautify_html,window.marked,window.HTML2Markdown)})(window);