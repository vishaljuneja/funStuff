(function(t){"function"==typeof define&&define.amd?define(t):"object"!=typeof module&&"function"!=typeof module||!module.exports?window.LucidJS=t():module.exports=t()})(function(){function t(t){function e(t){function n(){if(h[t]){for(o=0;s.length>o;o+=1)h[t].splice(h[t].indexOf(s[o]),1);1>h[t].length&&delete h[t]}}function r(t,n){function r(){var t;for(t=0;a.length>t;t+=1)a[t].clear()}var i,o={},a=[];for(i=0;t.length>i;i+=1)n.unshift(t[i]),a.push(e.apply(this,n)),n.shift();return o.clear=r,o}var o,a,s=Array.prototype.slice.apply(arguments,[1]),l={};if("object"==typeof t&&"function"==typeof t.push)return r(t,s);if("emitter"!==t.slice(0,7)&&i("emitter.listener",t,s),p[t]){for(o=0;s.length>o;o+=1){if("function"!=typeof s[o])throw Error("Cannot bind event. All callbacks must be functions.");for(a=0;p[t].length>a;a+=1)s[o].apply(this,p[t][a])}return l.clear=function(){},l}for(h[t]||(h[t]=[]),o=0;s.length>o;o+=1){if("function"!=typeof s[o])throw Error("Cannot bind event. All callbacks must be functions.");h[t].push(s[o])}return l.clear=n,l}function n(t){var e,r,i=Array.prototype.slice.apply(arguments,[1]);if("object"!=typeof t||"function"!=typeof t.push){if(!h[t])throw Error('Tried to remove an event from a non-existant event of type "'+t+'".');for(e=0;i.length>e;e+=1){if("function"!=typeof i[e])throw Error("Tried to remove a non-function.");var o=h[t].indexOf(i[e]);h[t].splice(o,1)}}else for(r=0;t.length>r;r+=1)n.apply(null,[t[r]].concat(i))}function r(t){var n,r=Array.prototype.slice.apply(arguments,[1]),i=!0;return n=e(t,function(){var t,e=Array.prototype.slice.apply(arguments);for(n.clear(),t=0;r.length>t;t+=1)r[t].apply(this,e)===!1&&(i=!1);return i})}function i(t,e,n,r,o,a){function s(t,e,n,r,o,a){var s,u=!0;for(a!==void 0&&(l=Array.prototype.slice.apply(arguments,[1])),s=0;t.length>s;s+=1)l?(args.unshift(t[s]),i.apply(this,args)===!1&&(u=!1),args.shift()):i(t[s],e,n,r,o)===!1&&(u=!1);return u}var l,u,c,d=!0;if(a!==void 0&&(l=Array.prototype.slice.apply(arguments,[1])),"object"==typeof t&&"function"==typeof t.push)return l?s.apply(null,arguments):s(t,e,n,r,o);for(t=t.split(".");t.length;){if(c=h[t.join(".")],"emitter"!==t[0]&&(l?i.apply(this,[].concat("emitter.event",t.join("."),l)):i("emitter.event",e,n,r,o)),c)for(c=[].concat(c),u=0;c.length>u;u+=1)l?c[u].apply(this,l)===!1&&(d=!1):c[u](e,n,r,o)===!1&&(d=!1);t.pop()}return d}function o(t){function e(t,e){var n,r=!0;for(n=0;t.length>n;n+=1)e.unshift(t[n]),i.apply(this,e)===!1&&(r=!1),e.shift();return r}function n(){p[t]&&(p[t].splice(p[t].indexOf(r),1),1>p[t].length&&delete p[t])}var r=Array.prototype.slice.apply(arguments),o={};return"object"==typeof t&&"function"==typeof t.push?e(t,r):(i.apply(this,r),c(t),p[t]||(p[t]=[]),p[t].push(r.slice(1)),o.clear=n,o)}function a(t){t?delete p[t]:p={}}function s(t){function n(t,n){t.listenerBinding=e("emitter.listener",function(e){-1===t.events.indexOf(e)&&(t.bindings.push(r(n,e)),t.events.push(e))})}function r(t,e){return t.on(e,function(){var t=Array.prototype.slice.apply(arguments);return t.unshift(e),i.apply(this,t)})}function o(){if(y.length)for(;y.length;)y[0].clear(),y.splice(0,1)}function a(){for(;v.length;){for(v[0].listenerBinding&&v[0].listenerBinding.clear();v[0].bindings.length;)v[0].bindings[0].clear(),v[0].bindings.splice(0,1);m.splice(m.indexOf(v[0]),1),v.splice(0,1)}}var l,u,c,d,f,p={},g=Array.prototype.slice.apply(arguments),v=[],y=[];if("object"==typeof t&&"function"==typeof t.push&&"string"==typeof t[0]){for(l=0;t.length>l;l+=1)y.push(s.apply(null,[t[l]].concat(g)));return p.clear=o,p}if("object"==typeof t&&"function"==typeof t.on?t=!1:g.shift(),t!==!1&&"string"!=typeof t)throw Error("Cannot create pipe. The first argument must be an event string or an emitter.");for(u=0;g.length>u;u+=1){for(c=0;m.length>c;c+=1)if(m[c].emitter===g[u]){d=m[c];break}if((!d||2!==d.type)&&(d||(d={},d.emitter=g[u],d.bindings=[],d.events=[],d.type=t?1:2),-1===d.events.indexOf(t))){if(d.events.push(t),1===d.type)f=r(g[u],t),f.event=t,d.bindings.push(f);else if(2===d.type){for(t in h)h.hasOwnProperty(t)&&(f=g[u].on(t,r),f.event=t,d.bindings.push(f),d.events.push(t));n(d,g[u])}v.push(d),m.push(d)}}return p.clear=a,p}function l(t){var e,n;for(e=0;m.length>e;e+=1){if(t){if(2===m[e].type)continue;if(-1===m[e].events.indexOf(t))continue;m[e].events.splice(m[e].events.indexOf(t),1)}for(2===m[e].type&&m[e].listenerBinding.clear(),n=0;m[e].bindings.length>n;n+=1)t&&m[e].bindings[n].event!==t||(m[e].bindings[n].clear(),m[e].bindings.splice(n,1),n-=1);1>m[e].bindings.length&&(m.splice(e,1),e-=1)}}function u(t){return t?h[t]:h}function c(t){t?delete h[t]:h={}}function d(t){function n(){var e;for(e=0;a.length>e;e+=1)try{t.removeEventListener?t.removeEventListener(a[e].event,a[e].listener,!1):t.detachEvent&&t.detachEvent("on"+a[e].event,a[e].listener)}catch(n){console.error(n)}o=[],r.clear()}var r,o=[],a=[];r=e("emitter.listener",function(e){function n(t){var n=Array.prototype.slice.apply(arguments);n.unshift([e,"dom."+e]),i.apply(this,n)===!1&&(t.preventDefault(),t.stopPropagation())}if(!(o.indexOf(e)>-1)){o.push(e);try{t.addEventListener?(t.addEventListener(e,n,!1),a.push({event:e,listener:n})):t.attachEvent&&(t.attachEvent("on"+e,n),a.push({event:e,listener:n}))}catch(r){console.error(r)}}}),f.clearNodeEmitter=n}var f=t||{},h={},p={},m=[];return f.on||f.once||f.trigger||f.set||f.pipe||f.listeners?f:(f.on=e,f.off=n,f.once=r,f.trigger=i,f.set=o,f.set.clear=a,f.pipe=s,f.pipe.clear=l,f.listeners=u,f.listeners.clear=c,(f.addEventListener||f.attachEvent)&&d(f),f)}var e;return e={emitter:t},[].indexOf||(Array.prototype.indexOf=function(t,e,n){for(n=this.length,e=(n+~~e)%n;n>e&&(!(e in this)||this[e]!==t);e++);return e^n?e:-1}),e});