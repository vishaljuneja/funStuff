define(["underscore","backbone","pages/forum/app","js/lib/backbone.api","js/lib/backbone.relational","js/lib/marked"],function(e,i,a,n,t,r){var d=i.RelationalModel.extend({defaults:{_viewer_vote:0,_viewer_voted:!1},api:a.api,partialUpdate:!0,textProp:null,entryType:null,initialize:function(){this.bind("change",this.updateThreadMaybe,this)},updateThreadMaybe:function(){this.changedAttributes()&&e.contains(e.keys(this.changedAttributes()),"_viewer_subscription")&&this.get("thread")&&this.get("thread").set("_viewer_subscription",this.get("_viewer_subscription"))},getPermalinkHash:function(){return this.entryType+"-"+this.get("id")},getPermalink:function(){return window.location.href.split("#")[0]+"#"+this.getPermalinkHash()},votesUrl:function(){return this.url()+"/"+this.get("id")+"/votes"},reportsUrl:function(){return this.url()+"/"+this.get("id")+"/reports"},getMessageHtml:function(){var e=this.get(this.textProp);return e?"html"==this.get("text_type")?e:r(e):""},getEditableHtml:function(){return this.getMessageHtml().replace("&lt;","&amp;lt;").replace("&gt;","&amp;gt;")}});return e.extend(d.prototype,n),d});