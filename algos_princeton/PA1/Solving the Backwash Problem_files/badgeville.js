(function(){var e=function(){return e};e.isEnabled=function(){return!!window.Badgeville},e.isAPILoaded=function(){return!(!window.Badgeville||!window.Badgeville.getAPI)},e.getPlayerId=function(e){return e+"@badgeville.coursera.org"},e.getPlayerObject=function(i,a){if(e.isEnabled()){Badgeville.PlayerCache||(Badgeville.PlayerCache={});var d=Badgeville.PlayerCache[i];d?a(d):Badgeville.getPlayer(i,function(e){a(e),Badgeville.PlayerCache[i]=e})}},e.setupPlayerTip=function(i,a){e.isEnabled()&&(e.getPlayerId(i),e.getPlayerObject(e.getPlayerId(i),function(e){Badgeville.Gears.playerTip(window.Badgeville(a),e)}))},e.renderByline=function(e,i){function a(e,i,a,d){if(0!==a){var n=$("<span></span>").css("margin-right","5px").attr("title",a+" "+i+" badges"),r=$('<span class="icon-circle"></span>');r.css({color:d,fontSize:"10px"});var t=$("<span></span>").css("font-weight","bold").append(a);n.append(r),n.append("&nbsp;"),n.append(t),e.append(n)}}function d(e,i){if(!e.definition.tags)return!1;for(var a=0;e.definition.tags.length>a;a++)if(e.definition.tags[a].toLowerCase()==i.toLowerCase())return!0;return!1}for(var n=0,r=0,t=0,l=0,s=0;e.length>s;s++){var p=e[s];p.definition&&(p.definition.name,d(p,"diamond")?l++:d(p,"gold")?t++:d(p,"silver")?r++:d(p,"bronze")&&n++)}a(i,"Bronze",n,"#a67c52"),a(i,"Silver",r,"#959595"),a(i,"Gold",t,"#dcae4b"),a(i,"Diamond",l,"white")},e.setupByline=function(i,a){e.isAPILoaded()&&(Badgeville.RewardsCache||(Badgeville.RewardsCache={}),e.getPlayerObject(e.getPlayerId(i),function(i){Badgeville.RewardsCache[i.id]?e.renderByline(Badgeville.RewardsCache[i.id],a):Badgeville.getAPI("player_rewards",{id:i.id},function(d){Badgeville.RewardsCache[i.id]=d.rewards,e.renderByline(Badgeville.RewardsCache[i.id],a)})}))},e.setupMissionsDisplay=function(i,a,d,n){function r(e,i){var a=$("<div></div>").addClass("coursera-badgeville-missions-badge"),d=$("<img></img>");return a.attr("title","To earn this badge, "+e.tip),a.append(d),d.attr("src",e.image_medium_url),i>0?i>1&&a.append('<span class="coursera-badgeville-missions-badge-num">'+i+"</span>"):(d.css("opacity",".4"),a.append('<span class="icon-lock"></span>')),a.append('<div class="coursera-badgeville-missions-badge-name">'+e.name+"</div>"),a}e.isAPILoaded()&&(Badgeville.MissionsCache||(Badgeville.MissionsCache={}),e.getPlayerObject(e.getPlayerId(i),function(e){Badgeville.getAPI("player_site_missions",{id:e.id},function(e){a.empty();var i,t,l,s,p,o,g=e.missions;if(!d){for(a.append("<h5>Badges</h5>"),t=0;g.length>t;t++)for(i=g[t],l=0;i.reward_definitions.length>l;l++)s=i.reward_definitions[l],p=i.reward_counters[s.id],p>0&&(o=r(s,p),a.append(o));return a.is(":empty")&&a.html("No badges yet. â˜¹"),void 0}var c=0,f=$("<h5>Single Badges</h5>");for(a.append(f),t=0;g.length>t;t++)if(i=g[t],"ladder"!=i.type)for(l=0;i.reward_definitions.length>l;l++)s=i.reward_definitions[l],p=i.reward_counters[s.id],p>0&&(o=r(s,p),a.append(o),c+=p);f.append(" ("+c+" earned)");var h=0,v=$("<h5>Badge Series</h5>");a.append(v);var u=$("<div></div>").addClass("coursera-badgeville-missions-header");for(u.append("<div></div>"),u.append("<h4>Bronze</h4>"),u.append("<h4>Silver</h4>"),u.append("<h4>Gold</h4>"),u.append("<h4>Diamond</h4>"),a.append(u),t=0;g.length>t;t++)if(i=g[t],"ladder"==i.type){var b=$("<div></div>").addClass("coursera-badgeville-missions-mission"),m=$("<div></div>");m.append("<h5>"+i.name+"</h5>"),b.append(m);var y=null,w=null;for(l=0;i.reward_definitions.length>l;l++){if(s=i.reward_definitions[l],p=i.reward_counters[s.id],o=r(s,p),0!==p||y||(y=s.tip,w=s.name.split("-")[0]),b.append(o),i.reward_definitions.length-1>l){var _=$("<div></div>").addClass("coursera-badgeville-missions-bridge");b.append(_)}h+=p}y?m.append("<p>To earn the next badge ("+w+"), "+n+" must "+y+".</p>"):m.append("<p>Congrats! You earned every badge in this series!</p>"),a.append(b)}v.append(" ("+h+" earned)")})}))},e.setupMissionsExplanation=function(i,a,d,n){function r(e){var i=$("<div></div>").css({"float":"left",position:"relative"}),a=$("<img></img>").css({width:"65px",height:"64px"});i.append(a),a.attr("src",e.image_medium_url);var d=RegExp(/\d+\s\w+/),n=e.tip.match(d)&&e.tip.match(d)[0];return n&&i.append("<div>"+n+"</div>").css({"text-align":"center","font-size":"13px"}),i}e.isAPILoaded()&&(n="you",e.getPlayerObject(e.getPlayerId(i),function(e){Badgeville.getAPI("player_site_missions",{id:e.id},function(e){a.empty();var i,d,n,t,l,s,p=e.missions,o={"border-bottom":"1px solid #CCC",clear:"left","padding-top":"15px"};for(a.append($("<h5>Single Badges</h5>").css(o)),d=0;p.length>d;d++)if(i=p[d],"ladder"!=i.type)for(n=0;i.reward_definitions.length>n;n++){t=i.reward_definitions[n];var g=$("<div></div>").css({"float":"left","margin-top":"10px"}),c=$("<div></div>").css({width:"300px","float":"left","padding-left":"8px"});c.append($("<h5>"+t.name+"</h5>").css({"margin-top":"0px","margin-bottom":"0px"})),c.append($("<p>To earn this badge, "+t.tip+"</p>").css({margin:"0px","margin-right":"10px"})),s=r(t),g.append(s),g.append(c),a.append(g)}a.append($("<h5>Badge Series</h5>").css(o)).css("clear","left");var f=$("<div></div>").css("clear","left");f.append($("<div>&nbsp;</div>").css({width:"300px","float":"left"}));var h={width:"63px","margin-right":"20px","text-align":"center","float":"left","font-size":"11px","margin-bottom":"0px","margin-top":"0px","text-transform":"uppercase"};for(f.append($("<h4>Bronze</h4>").css(h)),f.append($("<h4>Silver</h4>").css(h)),f.append($("<h4>Gold</h4>").css(h)),f.append($("<h4>Diamond</h4>").css(h)),a.append(f),d=0;p.length>d;d++)if(i=p[d],"ladder"==i.type){var v=$("<div></div>").css({"padding-top":"10px",clear:"left"}),u=$("<div></div>").css({width:"300px","float":"left"});for(u.append($("<h5>"+i.name+"</h5>").css("margin-top","0px")),u.append($("<p>To earn these badges, "+i.tip+"</p>").css({margin:"0px","margin-right":"10px"})),v.append(u),n=0;i.reward_definitions.length>n;n++)if(t=i.reward_definitions[n],l=i.reward_counters[t.id],s=r(t,l),v.append(s),i.reward_definitions.length-1>n){var b=$("<div></div>").css({"background-color":"#BDBDBD",width:"20px",height:"20px","float":"left","border-top":"4px solid lightGrey","border-bottom":"4px solid #9C9C9C","margin-top":"20px","margin-left":"-1px","margin-right":"-1px"});v.append(b)}a.append(v)}a.append('<p style="clear:both">* A reply/thread is considered "good" if it has been upvoted by 3 of your classmates.</p>')})}))},e.setPlayer=function(i){e.isEnabled()&&window.Badgeville.setPlayer({display_name:i.name,nickname:i.id,email:e.getPlayerId(i.id),picture_url:i.photo||null})},e.credit=function(i,a){e.isEnabled()&&window.Badgeville.credit(i,function(e){a&&a(e)})},e.creditOther=function(i,a){e.isEnabled()&&window.Badgeville.creditOther(e.getPlayerId(i),a)},e.getUserBucket=function(e){var i=[{top_byline:0,thread_byline:0,badge_ladder:0},{top_byline:0,thread_byline:0,badge_ladder:1},{top_byline:0,thread_byline:1,badge_ladder:0},{top_byline:0,thread_byline:1,badge_ladder:1},{top_byline:1,thread_byline:0,badge_ladder:0},{top_byline:1,thread_byline:0,badge_ladder:1},{top_byline:1,thread_byline:1,badge_ladder:0},{top_byline:1,thread_byline:1,badge_ladder:1}],a=i[e%8];return a},e.getWeek=function(e){var i=1,a=new Date(2013,3,22),d=e||new Date,n=d.getTime()-a.getTime(),r=n/1e3/60/60/24/7;return r>0&&(i=Math.ceil(r)),i},"function"==typeof define&&define.amd?define(["jquery"],function(i){return new e(i)}):window.BadgevilleUtil=e})();