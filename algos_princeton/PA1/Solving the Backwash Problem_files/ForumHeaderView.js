define(["backbone","jquery","underscore","js/lib/util","pages/forum/app","pages/forum/views/ForumHeaderView.html"],function(e,t,r,s,a,i){var o=e.View.extend({events:{"click .course-forum-subscribe-link":"onSubscribeClick","click .course-forum-unsubscribe-link":"onUnsubscribeClick","click .course-forum-controls-popup a":"onMarkReadClick"},initialize:function(){this.forum=this.model,this.forum.bind("change",this.render,this)},render:function(){var e=["_viewer_subscription"],t=this.forum.changedAttributes();return(!this.$(".course-forum-controls").length||t&&r.intersection(r.keys(t),e).length>0)&&this.$el.html(i({config:a.config,user:a.user,forum:this.forum})),this},onSubscribeClick:function(){var e=this;a.api.post(this.model.subscriptionsUrl(),{message:{waiting:"Subscribing...",success:"Subscribed!"}}).done(function(t){e.forum.set({_viewer_subscription:t})})},onUnsubscribeClick:function(){var e=this;a.api["delete"](this.model.subscriptionsUrl(),{message:{waiting:"Unsubscribing...",success:"Unsubscribed!"}}).done(function(t){e.forum.set({_viewer_subscription:t})})},onMarkReadClick:function(){var e=this;a.api.post(this.model.readRecordsUrl(),{message:{waiting:"Marking as read...",success:"Done!"}}).done(function(){e.forum.set({_marked_as_read:(new Date).getTime()})})}});return o});