define(["jquery","underscore","backbone","require","js/lib/modals","js/core/confirmNavigation.html"],function(t,e,i,r,o,n){i.View.prototype._super=function(t){return this.constructor.__super__[t].apply(this,e.rest(arguments))};var a=null,s={current:null,body:"#origami",views:{},beforeUnloadMessage:"There are unsaved changes that will be lost if you reload or leave this page.",regionHasUnsavedModel:function(t){if(!t)return!1;var e=t.view.hasUnsavedModel?t.view.hasUnsavedModel():!1;if(e)return!0;for(var i in t.regions){var r=t.regions[i];if(s.regionHasUnsavedModel(r))return!0}return!1}},l=i.Router.extend({initialize:function(){var e=this;e.routePrefix="",e.linkClass="internal",t("body").on("click","a.internal",function(i){i.ctrlKey||i.metaKey||(i.preventDefault(),e.navigate(t(i.currentTarget).attr("href"),!0))}),this.$confirmNavigation=t(n()),t("body").append(this.$confirmNavigation),t(window).on("beforeunload.origami",function(){return s.regionHasUnsavedModel(s.current)?s.beforeUnloadMessage:void 0})},setupLinks:function(e,i){var r=this;this.routePrefix=e,this.linkClass=i,t("body").on("click","a."+this.linkClass,function(e){e.ctrlKey||e.metaKey||(e.preventDefault(),r.navigateTo(t(e.currentTarget).attr("href"),!0))})},navigateTo:function(t,e){this.navigate(t.replace(this.routePrefix,""),e)},navigate:function(e,r){if(s.current&&s.regionHasUnsavedModel(s.current)){var n=t(".confirm-navigation-message");n.text(s.beforeUnloadMessage);var a=t(".confirm-navigation-leave");a.one("click",function(){i.Router.prototype.navigate.call(this,e,r)});var l={"overlay.class":"coursera-overlay"};o(".confirm-navigation",l).open()}else i.Router.prototype.navigate.call(this,e,r)},addRoutes:function(t){var e=this;for(var r in t)e.route(r,r,t[r]),e.route(r+"/",r+"/",function(){var t=i.history.getFragment(),r=t.replace(/\/(?:\?.*)*$/,"");e.navigate(r,{trigger:!0,replace:!0})})}}),u={resize:function(e,i,r){t("body").append(i.$el.css({visibility:"hidden"}));var o={from:e.$el.outerHeight(),to:i.$el.outerHeight()};e.$el.animate({height:o.to},300,function(){e.$el.replaceWith(i.$el.css({visibility:"visible"})),i.$el.find("img").on("load",function(){i.$el.animate({height:i.$el.outerHeight()})}),r&&r()})},slideLeft:function(e,i,r){var o=e.$el,n=i.$el,a=o.position(),s=o.outerWidth(),l=o.outerHeight(),u=t("<div>").css({position:"relative",width:s,height:l}),c={position:n.css("absolute")||"static",width:n.get(0).style.width,left:n.get(0).style.left},p={position:o.css("absolute")||"static",width:o.get(0).style.width,left:o.get(0).style.left};o.wrap(u),o.css({width:s,left:a.left,position:"absolute"}),n.css({width:s,left:a.left+s,position:"absolute"}),o.parent().append(n),o.animate({left:-s},{duration:500,step:function(t){n.css({left:a.left+s+t})},complete:function(){n.css(c),o.css(p).hide(),o.unwrap(),r&&r()}})},slideRight:function(e,i,r){var o=e.$el,n=i.$el,a=o.position(),s=o.outerWidth(),l=o.outerHeight(),u=t("<div>").css({position:"relative",width:s,height:l}),c={position:n.css("absolute")||"static",width:n.get(0).style.width,left:n.get(0).style.left},p={position:o.css("absolute")||"static",width:o.get(0).style.width,left:o.get(0).style.left};o.wrap(u),o.css({width:s,left:a.left,position:"absolute"}),n.css({width:s,left:-(a.left+s),position:"absolute"}),o.parent().append(n),o.animate({left:s},{duration:500,step:function(t){n.css({left:-(a.left+s)+t})},complete:function(){n.css(c),o.css(p).hide(),o.unwrap(),r&&r()}})},replace:function(t,e,i){t.$el.replaceWith(e.el),i&&i()}},c=function(e,i){var r=this,o=i||{};r.type=e,r.animate=o.animate||{},r.regions=o.regions||{},r.initialize=o.initialize||{},r.options={},r.id=o.id||e.prototype.name,r.name=e.prototype.name,r.view=null,r.regions=t.extend(!0,{},e.prototype.subregions,o.regions||{})};c.prototype.close=function(t){var i=this;e.each(i.regions,function(e,r){delete i.regions[r],e.close(t)}),t||i.view.remove(),i.view.undelegateEvents(),i.view.trigger("view:closed"),i.view.off("view")},c.prototype.closing=function(){this.view.trigger("view:closing"),delete s.views[this.view.cid]},c.prototype.render=function(t){var i=this;return e.each(i.regions,function(t){t.render(),t.parent=i}),i.view=new i.type(i.initialize),i.view.region=i,i.view.render(i.render),t&&i.view.on("view:appended",function(){t.trigger("region:appended",{name:i.name})}),i},c.prototype.appended=function(){var t=this;t.view&&setTimeout(function(){t.view.trigger("view:appended")},0)},c.prototype.append=function(t,e){var i=this;this.regions||(this.regions={});var r=function(r){for(var o,n=t,s=0;i.regions[n];)n+=++s;return i.regions[n]=r,r.render(a),o=e.to?i.view.$(e.to):i.view.$el,o.append(r.view.el),r.appended(),a.trigger("region:rendered",{name:r}),r};"string"==typeof t?a.region.fetch(t,e,r):r(new c(t,e))},c.prototype.is=function(t){return t.type==this.type&&t.id==this.id},c.prototype.replace=function(t,i){var r=this,o="replace",n={incoming:t.view.animate,outgoing:r.view.animate};e.isString(n.incoming)?o=n.incoming:e.isFunction(n.incoming)?o=n.incoming():e.isString(n.outgoing)?o=n.outgoing:e.isFunction(n.outgoing)&&(o=n.outgoing()),u[o]||(o="replace"),u[o](r.view,t.view,i)},c.prototype.merge=function(t,i){var r=this;r.is(t)?e.each(t.regions,function(t,e){r.regions[e].view.trigger("view:merging",t.initialize),r.regions[e].merge(t,i),r.regions[e].view.trigger("view:merged",t.initialize)}):r.name==t.name&&(r.closing(),t.render(i),r.replace(t,function(){r.parent&&(r.parent.regions[t.name]=t,t.parent=r.parent,r.parent.appended()),r.close(),t.appended()}))};var p=function(i,o){if(a)return a;a=this;var n=this;s.body=i,s.current=o,t(window).on("resize",function(){for(var t in s.views)s.views[t].trigger("view:resize")}),this.region={make:function(t,e){return new c(t,e)},fetch:function(t,i,o){var a=e.uniqueId();n.trigger("region:fetching",{name:t,uid:a}),r([t],function(e){n.trigger("region:fetched",{name:t,uid:a}),o(new c(e,i))})},append:function(t,e,i,r){t||(t={regions:{}});var o=function(i){for(var o=e,a=0;t.regions[o];)o+=++a;return t.regions[o]=i,i.render(n),r&&r(i),i.appended(),n.trigger("region:rendered",{name:i}),i};return"string"!=typeof e?o(new c(e,i)):(n.region.fetch(e,i,o),void 0)},open:function(i,r){var o=i,a={};e.isObject(i)&&(o=e.keys(i)[0],a=i[o]),n.region.fetch(o,a,r||function(i){var r=e.after(e.keys(i.regions||{}).length,function(){if(s.current){if(s.current.is(i))return s.current.merge(i,n),void 0;if(s.current.name==i.name)return i.render(n),s.current.replace(i,function(){s.current.close(),s.current=i,s.current.appended()}),void 0;s.current.close(!0)}s.current=i,t(s.body).html(s.current.render(n).view.el),s.current.appended(),e.each(s.current.regions,function(t){t.appended()})});e.each(i.regions,function(t,e){n.region.open(t,function(t){i.regions[e]=t,r(n)})})})}},this.animate=u,this.router=new l,this.store={},this.tracker=[]};return e.extend(p.prototype,i.Events),p});