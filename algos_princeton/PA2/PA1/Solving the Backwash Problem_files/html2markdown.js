(function(){var t=function(t){function n(t){var n,e=location.href,r=e.replace(/\/[^\/]*$/,"/"),a=e.replace(/#[^\/#]*$/,"");return/^[a-zA-Z]([a-zA-Z0-9 -.])*:/.test(t)?n=t:/^\x2f/.test(t)?(n=""!==location.protocol?location.protocol+"//":"",n+=location.hostname,"80"!=location.port&&(n+=":"+location.port),n+=t):n=/^#/.test(t)?a+t:r+t,encodeURI(n)}var e=function(t,n){return 0===t.indexOf(n)},r=function(t,n){return t.match(n+"$")==n};return function(a,i){function o(){var t="";if(m)for(var n=0;m.length-1>n;n++)t+="  ";return t+=s(m)}function u(t){var n={};for(var e in t){var r=t[e];n[r.name]=r}return n}function s(t){return t&&t.length>0?t.slice(-1)[0]:""}function l(t){if(!t)return"";for(var n=t.length-1;n>=0;n--)if(""!==t[n])return t[n];return""}function c(t){var n=!1;if(t==l(p)){for(;s(p)!=t;)p.pop();p.pop(),n=!0}return n}function f(t){for(var n=[];p.length>0&&s(p)!=t;){var e=p.pop();n.unshift(e)}return n.join("")}function h(t){var n=p.pop();if(n)if(t)p.push(n),r(n,"\n")||p.push("\n\n");else{var e;/\s*\n\n\s*$/.test(n)?(n=n.replace(/\s*\n\n\s*$/,"\n\n"),e=""):/\s*\n\s*$/.test(n)?(n=n.replace(/\s*\n\s*$/,"\n"),e="\n"):e=/\s+$/.test(n)?"\n\n":"\n\n",p.push(n),p.push(e)}}function d(){if(p.length>0){var t=s(p);r(t,"\n")||p.push("\n")}else p.push("\n")}var g=!1,p=[],m=[],v=[],y=[],b=[],x=[];i=i||{};var M=i.inlineStyle||!1,_={hr:"- - -\n\n",br:"  \n",title:"# ",h1:"# ",h2:"## ",h3:"### ",h4:"#### ",h5:"##### ",h6:"###### ",b:"**",strong:"**",i:"_",em:"_",dfn:"_","var":"_",cite:"_",span:" ",ul:"* ",ol:"1. ",dl:"- ",blockquote:"> "};try{var w,k=document.createElement("div");if(k.innerHTML=a||"",w=k,t(w,{start:function(t,r,a){var i;if(t=t.toLowerCase(),g&&console.log("start: "+t),!a||"br"==t||"hr"==t||"img"==t)switch(t){case"br":p.push(_[t]);break;case"hr":h(),p.push(_[t]);break;case"title":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":h(),p.push(_[t]);break;case"b":case"strong":case"i":case"em":case"dfn":case"var":case"cite":p.push(_[t]);break;case"code":case"span":if(b.length>0)break;/\s+$/.test(s(p))||p.push(_[t]);break;case"p":case"div":h();break;case"ul":case"ol":case"dl":m.push(_[t]),m.length>1?d():h();break;case"li":case"dt":var c=o();p.push(c);break;case"a":i=u(r),v.push(i),p.push("[");break;case"img":i=u(r);var f,w,k;if(k=i.src?n(i.src.value):"",!k)break;if(f=i.alt?i.alt.value.trim():"",w=i.title?i.title.value.trim():"",M||e(l(p),"["))e(l(p),"[")||h(),p.push("!["+f+"]("+k+(w?' "'+w+'"':"")+")"),e(l(p),"[")||h(!0);else{var A=x.indexOf(k);-1==A&&(x.push(k),A=x.length-1),h(),p.push("!["),""!==f?p.push(f):null!=w&&p.push(w),p.push("]["+A+"]"),h()}break;case"blockquote":h(),y.push(_[t]);break;case"pre":h(),b.push(!0),p.push("    ");break;case"table":p.push("<table>");break;case"thead":p.push("<thead>");break;case"tbody":p.push("<tbody>");break;case"tr":p.push("<tr>");break;case"td":p.push("<td>")}},chars:function(t){if(b.length>0)t=t.replace(/\n/g,"\n    ");else{if(""===t.trim())return p.push(""),void 0;t=t.replace(/\s+/g," ");var n=l(p);/\s+$/.test(n)&&(t=t.replace(/^\s+/g,""))}g&&console.log("text: "+t),y.length>0&&p.push(y.join("")),p.push(t)},end:function(t){switch(t=t.toLowerCase(),g&&console.log("end: "+t),t){case"title":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":c(_[t])||h(!0);break;case"p":case"div":for(;p.length>0&&""===s(p).trim();)p.pop();h(!0);break;case"b":case"strong":case"i":case"em":case"dfn":case"var":case"cite":c(_[t])||(p.push(f(_[t]).trim()),p.push(_[t]));break;case"a":var r=f("[");if(r=r.replace(/\s+/g," "),r=r.trim(),""===r){p.pop();break}var a,i=v.pop();if(a=i.href&&""!==i.href.value?n(i.href.value):"",""===a){p.pop(),p.push(r);break}if(p.push(r),M||e(s(p),"!")){e(s(p),"!")&&(r=p.pop(),r=p.pop()+r,h(),p.push(r));var u=i.title;p.push("]("+a+(u?' "'+u.value.trim().replace(/\s+/g," ")+'"':"")+")"),e(s(p),"!")&&h(!0)}else{var l=x.indexOf(a);-1==l&&(x.push(a),l=x.length-1),p.push("]["+l+"]")}break;case"ul":case"ol":case"dl":d(),m.pop();break;case"li":case"dt":var w=o();c(w)||(r=f(w).trim(),e(r,"[![")?(p.pop(),h(),p.push(r),h(!0)):(p.push(r),d()));break;case"blockquote":y.pop();break;case"pre":h(!0),b.pop();break;case"code":case"span":if(b.length>0)break;""===s(p).trim()?(p.pop(),p.push(_[t])):(r=p.pop(),p.push(r.trim()),p.push(_[t]));break;case"table":p.push("</table>");break;case"thead":p.push("</thead>");break;case"tbody":p.push("</tbody>");break;case"tr":p.push("</tr>");break;case"td":p.push("</td>");break;case"br":case"hr":case"img":}}},{nodesToIgnore:["script","noscript","object","iframe","frame","head","style","label"]}),!M)for(var A=0;x.length>A;A++)if(0===A){var S=p.pop();p.push(S.replace(/\s+$/g,"")),p.push("\n\n["+A+"]: "+x[A])}else p.push("\n["+A+"]: "+x[A])}catch(N){console.log(N.stack),console.trace()}return p.join("")}};"function"==typeof define&&define.amd?define(["js/lib/htmlparser"],function(n){return t(n)}):window.HTML2Markdown=t(window.HTMLParser)})();