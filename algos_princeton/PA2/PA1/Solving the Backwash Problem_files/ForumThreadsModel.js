define(["underscore","backbone","js/lib/backbone.api","js/lib/backbone.relational","js/lib/util","pages/forum/app","pages/forum/models/ThreadModel","pages/forum/models/ThreadCollection"],function(u,e,t,r,a,s,n,i){var o=e.RelationalModel.extend({defaults:{page:1,page_size:25,sort:"lastupdated"},api:s.api,relations:[{type:e.HasMany,key:"threads",relatedModel:n,collectionType:i}],loadPage:function(u){var e=this,t="forum/forums/"+this.get("id")+"/threads";return s.api.get(t,{data:{sort:this.get("sort"),tag_id:this.get("tag_id"),tag_name:this.get("tag_name"),page:u,page_size:this.get("page_size")},message:{waiting:"Fetching forum threads...",success:"Fetched threads!"}}).done(function(u){e.set(u),e.loadTriageStatus()})},loadTriageStatus:function(){var e=this;if(s.user.canModerateForum()&&e.get("threads")&&e.get("course_id")){var t=s.config.url.base+s.config.url.api+"support/get_triage_status?"+"course_id="+e.get("course_id")+"&"+"thread_ids="+this.get("threads").pluck("id").join(",");s.apiWWW.get(t,{dataType:"jsonp",type:"get",success:function(t){u.each(t,function(u){var t=e.get("threads").get(u.thread_id);t&&u.last_pinged&&t.set("_triage_status",u)}),e.set("_triage_update",(new Date).getTime())}})}}});return u.extend(o.prototype,t),o});