(function(){var t=function(t,e){function n(){return this.pos=0,this.token="",this.current_mode="CONTENT",this.tags={parent:"parent1",parentcount:1,parent1:""},this.tag_type="",this.token_text=this.last_token=this.last_text=this.token_type="",this.Utils={whitespace:"\n\r	 ".split(""),single_token:"br,input,link,meta,!doctype,basefont,base,area,hr,wbr,param,img,isindex,?xml,embed,?php,?,?=".split(","),extra_liners:"head,body,/html".split(","),in_array:function(t,e){for(var n=0;e.length>n;n++)if(t===e[n])return!0;return!1}},this.get_content=function(){for(var t="",e=[],n=!1;"<"!==this.input.charAt(this.pos);){if(this.pos>=this.input.length)return e.length?e.join(""):["","TK_EOF"];if(t=this.input.charAt(this.pos),this.pos++,this.line_char_count++,this.Utils.in_array(t,this.Utils.whitespace))e.length&&(n=!0),this.line_char_count--;else{if(n){if(this.line_char_count>=this.max_char){e.push("\n");for(var r=0;this.indent_level>r;r++)e.push(this.indent_string);this.line_char_count=0}else e.push(" "),this.line_char_count++;n=!1}e.push(t)}}return e.length?e.join(""):""},this.get_contents_to=function(t){if(this.pos==this.input.length)return["","TK_EOF"];var e="",n=RegExp("\\</"+t+"\\s*\\>","igm");n.lastIndex=this.pos;var r=n.exec(this.input),i=r?r.index:this.input.length;return i>this.pos&&(e=this.input.substring(this.pos,i),this.pos=i),e},this.record_tag=function(t){this.tags[t+"count"]?(this.tags[t+"count"]++,this.tags[t+this.tags[t+"count"]]=this.indent_level):(this.tags[t+"count"]=1,this.tags[t+this.tags[t+"count"]]=this.indent_level),this.tags[t+this.tags[t+"count"]+"parent"]=this.tags.parent,this.tags.parent=t+this.tags[t+"count"]},this.retrieve_tag=function(t){if(this.tags[t+"count"]){for(var e=this.tags.parent;e&&t+this.tags[t+"count"]!==e;)e=this.tags[e+"parent"];e&&(this.indent_level=this.tags[t+this.tags[t+"count"]],this.tags.parent=this.tags[e+"parent"]),delete this.tags[t+this.tags[t+"count"]+"parent"],delete this.tags[t+this.tags[t+"count"]],1==this.tags[t+"count"]?delete this.tags[t+"count"]:this.tags[t+"count"]--}},this.get_tag=function(t){var e,n,r="",i=[],o=!1,t=t!==void 0?t:!1,a=this.pos,s=this.line_char_count;do{if(this.pos>=this.input.length)return t&&(this.pos=a,this.line_char_count=s),i.length?i.join(""):["","TK_EOF"];r=this.input.charAt(this.pos),this.pos++,this.line_char_count++,this.Utils.in_array(r,this.Utils.whitespace)?(o=!0,this.line_char_count--):(("'"===r||'"'===r)&&(i[1]&&"!"===i[1]||(r+=this.get_unformatted(r),o=!0)),"="===r&&(o=!1),i.length&&"="!==i[i.length-1]&&">"!==r&&o&&(this.line_char_count>=this.max_char?(this.print_newline(!1,i),this.line_char_count=0):(i.push(" "),this.line_char_count++),o=!1),"<"===r&&(e=this.pos-1),i.push(r))}while(">"!==r);var u,c=i.join("");u=-1!=c.indexOf(" ")?c.indexOf(" "):c.indexOf(">");var f=c.substring(1,u).toLowerCase();if("/"===c.charAt(c.length-2)||this.Utils.in_array(f,this.Utils.single_token))t||(this.tag_type="SINGLE");else if("script"===f)t||(this.record_tag(f),this.tag_type="SCRIPT");else if("style"===f)t||(this.record_tag(f),this.tag_type="STYLE");else if(this.is_unformatted(f,l)){var h=this.get_unformatted("</"+f+">",c);i.push(h),e>0&&this.Utils.in_array(this.input.charAt(e-1),this.Utils.whitespace)&&i.splice(0,0,this.input.charAt(e-1)),n=this.pos-1,this.Utils.in_array(this.input.charAt(n+1),this.Utils.whitespace)&&i.push(this.input.charAt(n+1)),this.tag_type="SINGLE"}else if("!"===f.charAt(0))if(-1!=f.indexOf("[if")){if(-1!=c.indexOf("!IE")){var h=this.get_unformatted("-->",c);i.push(h)}t||(this.tag_type="START")}else if(-1!=f.indexOf("[endif"))this.tag_type="END",this.unindent();else if(-1!=f.indexOf("[cdata[")){var h=this.get_unformatted("]]>",c);i.push(h),t||(this.tag_type="SINGLE")}else{var h=this.get_unformatted("-->",c);i.push(h),this.tag_type="SINGLE"}else t||("/"===f.charAt(0)?(this.retrieve_tag(f.substring(1)),this.tag_type="END"):(this.record_tag(f),this.tag_type="START"),this.Utils.in_array(f,this.Utils.extra_liners)&&this.print_newline(!0,this.output));return t&&(this.pos=a,this.line_char_count=s),i.join("")},this.get_unformatted=function(t,e){if(e&&-1!=e.toLowerCase().indexOf(t))return"";var n="",r="",i=!0;do{if(this.pos>=this.input.length)return r;if(n=this.input.charAt(this.pos),this.pos++,this.Utils.in_array(n,this.Utils.whitespace)){if(!i){this.line_char_count--;continue}if("\n"===n||"\r"===n){r+="\n",this.line_char_count=0;continue}}r+=n,this.line_char_count++,i=!0}while(-1==r.toLowerCase().indexOf(t));return r},this.get_token=function(){var t;if("TK_TAG_SCRIPT"===this.last_token||"TK_TAG_STYLE"===this.last_token){var e=this.last_token.substr(7);return t=this.get_contents_to(e),"string"!=typeof t?t:[t,"TK_"+e]}if("CONTENT"===this.current_mode)return t=this.get_content(),"string"!=typeof t?t:[t,"TK_CONTENT"];if("TAG"===this.current_mode){if(t=this.get_tag(),"string"!=typeof t)return t;var n="TK_TAG_"+this.tag_type;return[t,n]}},this.get_full_indent=function(t){return t=this.indent_level+t||0,1>t?"":Array(t+1).join(this.indent_string)},this.is_unformatted=function(t,e){if(!this.Utils.in_array(t,e))return!1;if("a"!==t.toLowerCase()||!this.Utils.in_array("a",e))return!0;var n=this.get_tag(!0),r=(n||"").match(/^\s*<\s*\/?([a-z]*)\s*[^>]*>\s*$/);return!r||this.Utils.in_array(r,e)?!0:!1},this.printer=function(t,e,n,r,i){this.input=t||"",this.output=[],this.indent_character=e,this.indent_string="",this.indent_size=n,this.brace_style=i,this.indent_level=0,this.max_char=r,this.line_char_count=0;for(var o=0;this.indent_size>o;o++)this.indent_string+=this.indent_character;this.print_newline=function(t,e){if(this.line_char_count=0,e&&e.length){if(!t)for(;this.Utils.in_array(e[e.length-1],this.Utils.whitespace);)e.pop();e.push("\n");for(var n=0;this.indent_level>n;n++)e.push(this.indent_string)}},this.print_token=function(t){this.output.push(t)},this.indent=function(){this.indent_level++},this.unindent=function(){this.indent_level>0&&this.indent_level--}},this}var r,i,o,a,s,l;for(e=e||{},i=e.indent_size||4,o=e.indent_char||" ",s=e.brace_style||"collapse",a=0===e.max_char?1/0:e.max_char||70,l=e.unformatted||["a","span","bdo","em","strong","dfn","code","samp","kbd","var","cite","abbr","acronym","q","sub","sup","tt","i","b","big","small","u","s","strike","font","ins","del","pre","address","dt","h1","h2","h3","h4","h5","h6"],r=new n,r.printer(t,o,i,a,s);;){var u=r.get_token();if(r.token_text=u[0],r.token_type=u[1],"TK_EOF"===r.token_type)break;switch(r.token_type){case"TK_TAG_START":r.print_newline(!1,r.output),r.print_token(r.token_text),r.indent(),r.current_mode="CONTENT";break;case"TK_TAG_STYLE":case"TK_TAG_SCRIPT":r.print_newline(!1,r.output),r.print_token(r.token_text),r.current_mode="CONTENT";break;case"TK_TAG_END":if("TK_CONTENT"===r.last_token&&""===r.last_text){var c=r.token_text.match(/\w+/)[0],f=r.output[r.output.length-1].match(/<\s*(\w+)/);(null===f||f[1]!==c)&&r.print_newline(!0,r.output)}r.print_token(r.token_text),r.current_mode="CONTENT";break;case"TK_TAG_SINGLE":var h=r.token_text.match(/^\s*<([a-z]+)/i);h&&r.Utils.in_array(h[1],l)||r.print_newline(!1,r.output),r.print_token(r.token_text),r.current_mode="CONTENT";break;case"TK_CONTENT":""!==r.token_text&&r.print_token(r.token_text),r.current_mode="TAG";break;case"TK_STYLE":case"TK_SCRIPT":if(""!==r.token_text){r.output.push("\n");var d=r.token_text;if("TK_SCRIPT"==r.token_type)var p="function"==typeof js_beautify&&js_beautify;else if("TK_STYLE"==r.token_type)var p="function"==typeof css_beautify&&css_beautify;if("keep"==e.indent_scripts)var g=0;else if("separate"==e.indent_scripts)var g=-r.indent_level;else var g=1;var m=r.get_full_indent(g);if(p)d=p(d.replace(/^\s*/,m),e);else{var v=d.match(/^\s*/)[0],y=v.match(/[^\n\r]*$/)[0].split(r.indent_string).length-1,b=r.get_full_indent(g-y);d=d.replace(/^\s*/,m).replace(/\r\n|\r|\n/g,"\n"+b).replace(/\s*$/,"")}d&&(r.print_token(d),r.print_newline(!0,r.output))}r.current_mode="TAG"}r.last_token=r.token_type,r.last_text=r.token_text}return r.output.join("")};"function"==typeof define&&define.amd?define([],function(){return t}):"undefined"!=typeof window&&"undefined"==typeof ender&&(window.beautify_html=t)})(window);