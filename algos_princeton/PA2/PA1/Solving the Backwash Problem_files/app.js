define(["jquery","underscore","backbone","js/core/coursera","js/lib/api","js/lib/asyncMessages"],function(e,t,o,n,r,i){var s=e("<div>").appendTo("body").addClass("coursera-async-message");return n.message=i.create(s),n.on("region:fetching",function(t){n.message.add(e("<div>loading page</div>").addClass("waiting"),{id:t.name+t.uid})}),n.on("region:fetched",function(e){n.message.remove(e.name+e.uid)}),n.setup=function(e){n.path=e,n.path&&(n.apiWWW=new r("",{type:"rest","csrf.cookie":"csrf_token","csrf.token":"X-CSRF-Token"}),n.api=r("/"+n.path+"/api/",{message:n.message,type:"rest","csrf.cookie":"csrf_token","csrf.token":"X-CSRF-Token","csrf.path":"/"+n.path+"/"}),n.api.on("always",function(e){e.xhr.status>=400?n.multitracker.push(["api.error."+e.xhr.status,{timing:e.timing,url:e.url,status:e.xhr.status,response:e.xhr.responseText}]):n.multitracker.push(["api.ok."+e.xhr.status,{timing:e.timing,url:e.url,status:e.xhr.status}])}))},n.setup(location.pathname.match(RegExp("^/([^/]*)/.*"))[1]),n});